# 设计模式之美

### 开篇词 | 一对一的设计与编码集训，让你告别没有成长的烂代码！

### 01 | 为什么说每个程序员都要尽早地学习并掌握设计模式相关知识？

### 02 | 从哪些维度评判代码质量的好坏？如何具备写出高质量代码的能力？

***如何评价代码质量的高低？***

代码质量高低是一个综合各种因素得到的结论，我们并不能通过单一的维度去评价一段代码的好坏。

不同的评价维度也并不是完全独立的，有些是具有包含关系、重叠关系或者可以互相影响的。而且，各种评价维度也不是非黑即白的。

对一段代码的质量评价，常常有很强的主观性。

***最常用的评价标准有哪几个？***

**可维护性（maintainability）**

我们可以从侧面上给出一个比较主观但又比较准确的感受。如果 bug 容易修复，修改、添加功能能够轻松完成，那我们就可以主观地认为代码对我们来说易维护。相反，如果修改一个 bug，修改、添加一个功能需要花费很长的时间，那我们就可以主观地认为代码对我们来说不易维护。

***可读性（readability）***

实际上，code review 是一个很好的测验代码可读性的手段。如果你的同事可以轻松地读懂你写的代码，那说明你的代码可读性很好；如果同事在读你的代码时有很多疑问，那就说明你的代码可读性有待提高了。

**可扩展性（extensibility）**

说直白点就是，代码预留了一些功能扩展点，你可以把新功能代码直接插到扩展点上，而不需要因为要添加一个功能而大动干戈，改动大量的原始代码。

**灵活性（flexibility）**

**简洁性（simplicity）**

实际上，思从深而行从简，真正的高手能云淡风轻地用最简单的方法解决最复杂的问题。

**可复用性（reusability）**

**可测试性（testability）**

代码的可测试性差，比较难写单元测试，那基本上就能说明代码设计得有问题。

***如何才能写出高质量的代码？***

问如何写出高质量的代码，也就等同于在问如何写出易维护、易读、易扩展、灵活、简洁、可复用、可测试的代码。

要写出满足这些评价标准的高质量代码，我们需要掌握一些更加细化、更加能落地的编程方法论，包括面向对象设计思想、设计原则、设计模式、编码规范、重构技巧等。

### 03 | 面向对象、设计原则、设计模式、编程规范、重构，这五者有何关系？

***面向对象***

面向对象编程因为其具有丰富的特性（封装、抽象、继承、多态），可以实现很多复杂的设计思路，是很多设计原则、设计模式编码实现的基础。

***设计原则***

对于每一种设计原则，我们需要掌握它的设计初衷，能解决哪些编程问题，有哪些应用场景。

***设计模式***

设计模式是针对软件开发中经常遇到的一些设计问题，总结出来的一套解决方案或者设计思路。

这一块的学习难点是了解它们都能解决哪些问题，掌握典型的应用场景，并且懂得不过度应用。

***编程规范***

***代码重构***

不仅仅是掌握一些重构技巧、套路，更重要的是建立持续重构意识，把重构当作开发的一部分，融入到日常的开发中。

***五者之间的联系***

实际上，面向对象、设计原则、设计模式、编程规范、代码重构，这五者都是保持或者提高代码质量的方法论，本质上都是服务于编写高质量代码这一件事的。

### 04 | 理论一：当谈论面向对象的时候，我们到底在谈论什么？

***什么是面向对象编程和面向对象编程语言？***

面向对象编程是一种编程范式或编程风格，它以类或对象作为组织代码的基本单元，并将封装、抽象、继承、多态四个特性作为代码设计和实现的基石 。

面向对象编程语言是支持类或对象的语法机制，并有现成的语法机制，能方便地实现面向对象编程四大特性（封装、抽象、继承、多态）的编程语言。

一般来讲， 面向对象编程都是通过使用面向对象编程语言来进行的，但是，不用面向对象编程语言，我们照样可以进行面向对象编程。反过来讲，即便我们使用面向对象编程语言，写出来的代码也不一定是面向对象编程风格的，也有可能是面向过程编程风格的。

***如何判定某编程语言是否是面向对象编程语言？***

我个人觉得，只要某种编程语言支持类或对象的语法概念，并且以此作为组织代码的基本单元，那就可以被粗略地认为它就是面向对象编程语言了。至于是否有现成的语法机制、是否完全地支持了面向对象编程的四大特性、是否对四大特性有所取舍和优化，可以不作为判定的标准。

***什么是面向对象分析和面向对象设计？***

分析和设计两个阶段最终的产出是类的设计，包括程序被拆解为哪些类，每个类有哪些属性方法，类与类之间如何交互等等。

简单点讲，面向对象分析就是要搞清楚做什么，面向对象设计就是要搞清楚怎么做，面向对象编程就是将分析和设计的的结果翻译成代码的过程。

### 05 | 理论二：封装、抽象、继承、多态分别可以解决哪些编程问题？

***封装（Encapsulation）***

封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问接口，授权外部仅能通过类提供的方式（或者叫函数）来访问内部信息或者数据。

对于封装这个特性，我们需要编程语言本身提供一定的语法机制来支持，这个语法机制就是访问权限控制。

**封装的意义是什么？它能解决什么编程问题？**

如果我们对类中属性的访问不做限制，那任何代码都可以访问、修改类中的属性，虽然这样看起来更加灵活，但从另一方面来说，过度灵活也意味着不可控，属性可以随意被以各种奇葩的方式修改，而且修改逻辑可能散落在代码中的各个角落，势必影响代码的可读性、可维护性。

除此之外，类仅仅通过有限的方法暴露必要的操作，也能提高类的易用性。如果我们把类属性都暴露给类的调用者，调用者想要正确地操作这些属性，就势必要对业务细节有足够的了解，而这对于调用者来说也是一种负担。

***抽象（Abstraction）***

抽象讲的是如何隐藏方法的具体实现，让调用者只需要关心方法提供了哪些功能，并不需要知道这些功能是如何实现的。

在面向对象编程中，我们常借助编程语言提供的接口类（比如 Java 中的 interface 关键字语法）或者抽象类（比如 Java 中的 abstract 关键字语法）这两种语法机制来实现抽象这一特性。

类的方法是通过编程语言中的“函数”这一语法机制来实现的，通过函数包裹具体的实现逻辑，这本身就是一种抽象。调用者在使用函数的时候，并不需要去研究函数内部的实现逻辑，只需要通过函数的命名、注释或者文档了解其提供了什么功能，就可以直接使用了。

抽象这个概念是一个非常通用的设计思想，并不单单用在面向对象编程中，也可以用来指导架构设计等。而且这个特性也并不需要编程语言提供特殊的语法机制来支持，只需要提供“函数”这一非常基础的语法机制就可以实现抽象特性，所以，它没有很强的“特异性”，有时候并不被看作面向对象编程的特性之一。

**抽象的意义是什么？它能解决什么编程问题？**

在面对复杂系统的时候，人脑能承受的信息复杂程度是有限的，所以我们必须忽略掉一些非关键性的实现细节。而抽象作为一种只关注功能点不关注实现的设计思路，正好帮我们的大脑过滤掉许多非必要的信息。

除此之外，抽象作为一个非常宽泛的设计思想，在代码设计中起到非常重要的指导作用。很多设计原则都体现了抽象这种设计思想，比如基于接口而非实现编程、开闭原则（对扩展开放，对修改关闭）、代码解耦（降低代码的耦合性）等。

换一个角度来考虑，我们在定义（或者叫命名）类的方法的时候，也要有抽象思维，不要在方法定义中暴露太多的实现细节，以保证在某个时间点需要改变方法的实现逻辑的时候不用去修改其定义。

***继承（Inheritance）***

继承是用来表示类之间的 is-a 关系，比如猫是一种哺乳动物。

为了实现继承这个特性，编程语言需要提供特殊的语法机制来支持，比如 Java 使用 extends 关键字来实现继承。

**继承存在的意义是什么？它能解决什么编程问题？**

继承最大的一个好处就是代码复用。不过，这并不是继承所独有的，我们可以通过其他方式来解决代码复用的问题，比如利用组合关系而不是继承关系。

猫属于哺乳动物，从人类认知的角度上来说是一种 is-a 关系。我们通过继承来关联两个类，反应真实世界中的这种关系，非常符合人类的认知，而且，从设计的角度来说，也有一种结构美感。

***多态（Polymorphism）***

多态是指子类可以替换父类，在实际的代码运行过程中调用子类的方法实现。

**多态特性的实现方式**

利用继承加方法重写

利用接口类语法

利用 duck-typing 语法

**多态特性存在的意义是什么？它能解决什么编程问题？**

多态特性能提高代码的可扩展性和复用性。

除此之外，多态也是很多设计模式、设计原则、编程技巧的代码实现基础，比如策略模式、基于接口而非实现编程、依赖倒置原则、里氏替换原则、利用多态去掉冗长的 if-else 语句等等。

### 06 | 理论三：面向对象相比面向过程有哪些优势？面向过程真的过时了吗？

***什么是面向过程编程与面向过程编程语言？***

面向过程编程是一种编程范式或编程风格，它以过程（可以理解为方法、函数、操作）作为组织代码的基本单元，以数据（可以理解为成员变量、属性）与方法相分离为最主要的特点。面向过程风格是一种流程化的编程风格，通过拼接一组顺序执行的方法来操作数据完成一项功能。

面向过程编程语言最大的特点是不支持类和对象两个语法概念，不支持丰富的面向对象编程特性（比如继承、多态、封装），仅支持面向过程编程。

面向过程风格的代码被组织成了一组方法集合及其数据结构，方法和数据结构的定义是分开的。面向对象风格的代码被组织成一组类，方法和数据结构被绑定一起，定义在类中。

***面向对象编程相比面向过程编程有哪些优势？***

**OOP 更加能够应对大规模复杂程序的开发**

因为需求足够简单，整个程序的处理流程只有一条主线，很容易被划分成顺序执行的几个步骤，然后逐句翻译成代码，这就非常适合采用面向过程这种面条式的编程风格来实现。

对于大规模复杂程序的开发来说，整个程序的处理流程错综复杂，并非只有一条主线，如果把整个程序的处理流程画出来的话，会是一个网状结构。如果我们再用面向过程编程这种流程化、线性的思维方式去翻译这个网状结构，去思考如何把程序拆解为一组顺序执行的方法就会比较吃力。

面向对象编程以类为思考对象，在进行面向对象编程的时候，我们并不是一上来就去思考如何将复杂的流程拆解为一个一个方法，而是采用曲线救国的策略，先去思考如何给业务建模，如何将需求翻译为类，如何给类之间建立交互关系，而完成这些工作完全不需要考虑错综复杂的处理流程。当我们有了类的设计之后，然后再像搭积木一样，按照处理流程将类组装起来形成整个程序。这种开发模式、思考问题的方式，能让我们在应对复杂程序开发的时候思路更加清晰。

类就是一种非常好的组织这些函数和数据结构的方式，是一种将代码模块化的有效手段。

**OOP 风格的代码更易复用、易扩展、易维护**

面向对象编程提供的封装、抽象、继承、多态这些特性，能极大地满足复杂的编程需求，能方便我们写出更易复用、易扩展、易维护的代码。

***OOP 语言更加人性化、更加高级、更加智能***

在进行面向对象编程时候，我们是在思考如何给业务建模，如何将真实的世界映射为类或者对象，这让我们更加能聚焦到业务本身，而不是思考如何跟机器打交道。